<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Update Listing</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
    rel="icon"
    href="https://scrnshts.club/wp-content/uploads/2022/05/ico.png"/>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --airbnb-pink: #ff385c;
        --airbnb-dark: #222222;
        --airbnb-light-gray: #f7f7f7;
        --airbnb-medium-gray: #ebebeb;
        --airbnb-text-gray: #717171;
      }

      body {
        font-family: "Circular", -apple-system, BlinkMacSystemFont, sans-serif;
        background-color: var(--airbnb-light-gray);
        color: var(--airbnb-dark);
        line-height: 1.5;
        padding: 20px;
      }

      .app-container {
        max-width: 1200px;
        width: 100%;
        margin: 0 auto;
        padding: 30px;
        background-color: white;
        border-radius: 12px;
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
      }

      .section-header {
        display: flex;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 0.75rem;
        border-bottom: 1px solid var(--airbnb-medium-gray);
      }

      .section-header i {
        color: var(--airbnb-pink);
        font-size: 1.5rem;
        margin-right: 1rem;
      }

      .section-title {
        font-size: 1.5rem;
        font-weight: 600;
        margin: 0;
      }

      .form-section {
        margin-bottom: 2.5rem;
      }

      .form-label {
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: var(--airbnb-dark);
      }

      .form-control {
        padding: 0.75rem 1rem;
        border-radius: 8px;
        border: 1px solid var(--airbnb-medium-gray);
        transition: border-color 0.2s;
        width: 100%;
      }

      .form-control:focus {
        border-color: var(--airbnb-pink);
        box-shadow: 0 0 0 2px rgba(255, 56, 92, 0.2);
      }

      .input-group-text {
        background-color: var(--airbnb-light-gray);
        border: 1px solid var(--airbnb-medium-gray);
        color: var(--airbnb-text-gray);
      }

      textarea.form-control {
        min-height: 120px;
      }

      .character-count {
        text-align: right;
        font-size: 0.875rem;
        color: var(--airbnb-text-gray);
        margin-top: 0.25rem;
      }

      .btn-primary {
        background-color: var(--airbnb-pink);
        border-color: var(--airbnb-pink);
        padding: 0.75rem 1.5rem;
        font-weight: 600;
        border-radius: 8px;
        transition: all 0.2s;
        width: 100%;
        max-width: 300px;
        margin: 0 auto;
        display: block;
      }

      .btn-primary:hover {
        background-color: #e61e4d;
        border-color: #e61e4d;
        transform: scale(1.02);
      }

      .btn-primary:active {
        background-color: #d50c3d;
        border-color: #d50c3d;
      }

      .text-muted {
        color: var(--airbnb-text-gray) !important;
        font-size: 0.875rem;
      }

      /* Form validation styles */
      .was-validated .form-control:invalid,
      .form-control.is-invalid {
        border-color: #dc3545;
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right calc(0.375em + 0.1875rem) center;
        background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
      }

      .was-validated .form-control:valid,
      .form-control.is-valid {
        border-color: #198754;
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%23198754' d='M2.3 6.73L.6 4.53c-.4-1.04.46-1.4 1.1-.8l1.1 1.4 3.4-3.8c.6-.63 1.6-.27 1.2.7l-4 4.6c-.43.5-.8.4-1.1.1z'/%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right calc(0.375em + 0.1875rem) center;
        background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
      }

      .invalid-feedback {
        color: #dc3545;
        font-size: 0.875rem;
        margin-top: 0.25rem;
      }

      /* Responsive adjustments */
      @media (max-width: 1200px) {
        .app-container {
          padding: 25px;
        }
      }

      @media (max-width: 992px) {
        .app-container {
          padding: 20px;
        }

        .section-title {
          font-size: 1.3rem;
        }
      }

      @media (max-width: 768px) {
        .app-container {
          padding: 15px;
        }

        .section-title {
          font-size: 1.2rem;
        }

        .btn-primary {
          max-width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <style>
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
          font-family: Arial, sans-serif;
      }

      header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 15px 30px;
          box-shadow: 0 2px 4px rgba(0,0,0,0.1);
          position: relative;
      }

      .logo {
          display: flex;
          align-items: center;
          font-size: 1.5em;
          font-weight: bold;
          color: #ff5a5f;
      }

      .logo img {
          height: 40px;
          margin-right: 10px;
      }

      nav {
          display: flex;
          gap: 20px;
          position: absolute;
          right: 22px;
      }

      nav a {
          text-decoration: none;
          color: #484848;
          font-weight: 500;
          transition: color 0.3s ease;
      }

      nav a:hover {
          color: #ff5a5f;
      }

      .mobile-dropdown-btn {
          display: none;
          flex-direction: column;
          background: none;
          border: none;
          cursor: pointer;
      }

      .mobile-dropdown-btn span {
          width: 25px;
          height: 3px;
          background-color: #484848;
          margin: 3px 0;
          transition: all 0.3s ease;
      }

      .mobile-dropdown-content {
          display: none;
      }

      @media screen and (max-width: 768px) {
          nav {
              display: none;
          }

          .mobile-dropdown-btn {
              display: flex;
          }

          .mobile-dropdown-content {
              display: none;
              position: absolute;
              top: 100%;
              right: 30px;
              width: 250px;
              background-color: rgba(255, 255, 255, 0.9);
              box-shadow: 0 4px 6px rgba(0,0,0,0.1);
              border-radius: 12px;
              overflow: hidden;
              backdrop-filter: blur(10px);
              z-index: 100;
          }

          .mobile-dropdown-content a {
              padding: 15px;
              text-align: left;
              border-bottom: 1px solid #f0f0f0;
              display: block;
              color: #484848;
              transition: background-color 0.3s ease;
          }

          .mobile-dropdown-content a:hover {
              background-color: rgba(0,0,0,0.05);
              color: #ff5a5f;
          }

          .mobile-dropdown-content.show {
              display: block;
          }
      }
      .back {
        background-color: #d50c3d;
        color: #ebebeb;
        border-radius: 50px;
        font-size: 28px;
      }
      .piche{
        margin-top: -1rem;
      }
      .pich{
        margin-top: -3rem;
      }
  </style>
</head>
<body>
  <header>
      <div class="logo">
          <img 
              src="https://logos-world.net/wp-content/uploads/2020/07/Airbnb-Emblem.png" 
              alt="WonderLust Logo"
          />
          WonderLust
      </div>
      <nav>
        <a href="/listings"
        ><i class="fa-solid fa-house"></i>&nbsp;&nbsp; Homes</a
      >
      <a href="/listings"
        ><i class="fa-solid fa-globe"></i>&nbsp;&nbsp;Experiences</a
      >
      <a href="/listings/new"
        ><i class="fa-solid fa-location-dot"></i>&nbsp;&nbsp; Airbnb your
        home</a
      >
      <%if(!currentUser){%>
      <a href="/auth"
        ><i class="fa-solid fa-right-to-bracket"></i>
        &nbsp;&nbsp;Login/SignUp</a
      >
      <%}%> <%if(currentUser){%>
      <a href="/logout"
        ><i class="fa-solid fa-right-from-bracket"></i>&nbsp;&nbsp; Logout</a
      >
      <%}%>
      <a href="/user/liked-listings">
        <i class="fas fa-heart"></i>&nbsp;&nbsp; Favorites
      </a>
      </nav>
      <div class="mobile-dropdown">
          <button class="mobile-dropdown-btn" onclick="toggleDropdown()">
              <span></span>
              <span></span>
              <span></span>
          </button>
          <div class="mobile-dropdown-content">
            <a href="/listings"
            ><i class="fa-solid fa-house"></i>&nbsp;&nbsp; Homes</a
          >
          <a href="/listings"
            ><i class="fa-solid fa-globe"></i>&nbsp;&nbsp;Experiences</a
          >
          <a href="/listings/new"
            ><i class="fa-solid fa-location-dot"></i>&nbsp;&nbsp; Airbnb your
            home</a
          >
          <%if(!currentUser){%>
          <a href="/auth"
            ><i class="fa-solid fa-right-to-bracket"></i>
            &nbsp;&nbsp;Login/SignUp</a
          >
          <%}%> <%if(currentUser){%>
          <a href="/logout"
            ><i class="fa-solid fa-right-from-bracket"></i>&nbsp;&nbsp; Logout</a
          >
          <%}%>
          <a href="/user/liked-listings">
            <i class="fas fa-heart"></i>&nbsp;&nbsp; Favorites
          </a>
          </div>
      </div>
  </header>
  <%- include('../partials/flash') %> 
  <div class="app-container">
    <h1 class="mb-4 back" style="text-align: center">
      Update Your Listing
    </h1>
    <form
      class="listing-form needs-validation"
      method="POST"
      action="/listings/<%=listing._id%>/?_method=PUT"
      novalidate
    >
      <div class="form-section">
        <div class="section-header">
          <i class="fas fa-home"></i>
          <h2 class="section-title">Basic Information</h2>
        </div>

        <div class="row">
          <div class="col-12 mb-3">
            <label for="title" class="form-label">Listing Title</label>
            <input
              type="text"
              class="form-control"
              id="title"
              name="listing[title]"
              required
              placeholder="Cozy beachfront cottage"
              value="<%=listing.title%>"
              minlength="10"
              maxlength="100"
            />
            <div class="invalid-feedback">
              Please provide a title (at least 10 characters).
            </div>
          </div>

          <div class="col-12">
            <label for="description" class="form-label">Description</label>
            <textarea
              class="form-control"
              id="description"
              name="listing[description]"
              rows="1"
              required
              placeholder="Tell guests what makes your place special"
              minlength="20"
              maxlength="500"
            ><%=listing.description%></textarea>
            <div class="character-count">0/500</div>
            <div class="invalid-feedback">
              Please provide a description (at least 20 characters).
            </div>
          </div>
        </div>
      </div>

      <div class="form-section pich">
        <div class="section-header">
          <i class="fas fa-image"></i>
          <h2 class="section-title">Photos</h2>
        </div>

        <div class="row piche">
          <div class="col-12">
            <label for="image" class="form-label">Main Photo URL</label>
            <input
              type="url"
              class="form-control"
              id="image"
              name="listing[image]"
              placeholder="https://example.com/your-photo.jpg"
              value="<%=listing.image%>"
              required
              pattern="https?://.+"
            />
            <div class="invalid-feedback">
              Please provide a valid image URL (must start with http:// or https://).
            </div>
            <small class="text-muted">Add more photos after creating your listing</small>
          </div>
        </div>
      </div>

      <div class="form-section piche">
        <div class="section-header">
          <i class="fas fa-tag"></i>
          <h2 class="section-title">Pricing</h2>
        </div>

        <div class="row piche">
          <div class="col-md-6">
            <label for="price" class="form-label">Price per Night</label>
            <div class="input-group has-validation">
              <span class="input-group-text">₹</span>
              <input
                type="number"
                class="form-control"
                id="price"
                name="listing[price]"
                min="1"
                required
                placeholder="100"
                value="<%=listing.price%>"
              />
              <div class="invalid-feedback">
                Please provide a valid price (minimum ₹100).
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="form-section piche">
        <div class="section-header">
          <i class="fas fa-map-marker-alt"></i>
          <h2 class="section-title">Location</h2>
        </div>

        <div class="row piche">
          <div class="col-md-6 mb-3">
            <label for="country" class="form-label">Country</label>
            <input
              type="text"
              class="form-control"
              id="country"
              name="listing[country]"
              required
              placeholder="Country"
              value="<%=listing.country%>"
            />
            <div class="invalid-feedback">
              Please provide a country.
            </div>
          </div>
          <div class="col-md-6 piche">
            <label for="location" class="form-label">City/Area</label>
            <input
              type="text"
              class="form-control"
              id="location"
              name="listing[location]"
              required
              placeholder="City or area"
              value="<%=listing.location%>"
            />
            <div class="invalid-feedback">
              Please provide a city or area.
            </div>
          </div>
        </div>
      </div>

      <div class="row mt-4">
        <div class="col-12">
          <button type="submit" class="btn btn-primary btn-lg">
            <i class="fas fa-save me-2"></i>Update Listing
          </button>
        </div>
      </div>
    </form>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Character count for description
    const description = document.getElementById("description");
    const charCount = document.querySelector(".character-count");

    if (description && charCount) {
      // Set initial count
      charCount.textContent = `${description.value.length}/500`;

      // Update count on input
      description.addEventListener("input", () => {
        charCount.textContent = `${description.value.length}/500`;
      });
    }

    // Bootstrap form validation
    (() => {
      'use strict';

      // Fetch all forms that need validation
      const forms = document.querySelectorAll('.needs-validation');

      // Loop over them and prevent submission
      Array.from(forms).forEach(form => {
        form.addEventListener('submit', event => {
          if (!form.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
          }

          form.classList.add('was-validated');
        }, false);
      });
    })();

    // Toggle mobile dropdown
    function toggleDropdown() {
      const dropdownContent = document.querySelector('.mobile-dropdown-content');
      dropdownContent.classList.toggle('show');
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', function(event) {
      const dropdown = document.querySelector('.mobile-dropdown-content');
      const dropdownBtn = document.querySelector('.mobile-dropdown-btn');
      
      if (dropdown.classList.contains('show') && 
          !dropdown.contains(event.target) && 
          !dropdownBtn.contains(event.target)) {
          dropdown.classList.remove('show');
      }
    });
  </script>
</body>
</html>